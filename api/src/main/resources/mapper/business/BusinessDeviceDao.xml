<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="io.renren.modules.business.dao.BusinessDeviceDao">
    <!-- 可根据自己的需求，是否要使用 -->
    <sql id="Base_Column_List">
        id,
        one_level_name,
        two_level_name,
        en,
        address,
        disk,
        `name`,
        public_ip,
        group_name,
        manage_name,
        pingpai,
        mac,
        `owner`,
        owner_no,
        location_address,
        `date`,
        re,
        cname,
        ip,
        devtype,
        gip,
        height,
        gap,
        loratm,
        witnesstm,
        beacontm,
        lastwitness,
        import_data_time,
        total24h,
        total7d,
        total30d,
        `online`,
        country,
        city,
        street,
        Hex,
        depllist,
        `status`,
        hearttm,
        update_time,
        remark,
        errStatus,
        scale
    </sql>
    <resultMap type="io.renren.modules.business.entity.BusinessDeviceEntity" id="businessDeviceMap">
        <result property="id" column="id"/>
        <result property="oneLevelName" column="one_level_name"/>
        <result property="twoLevelName" column="two_level_name"/>
        <result property="en" column="en"/>
        <result property="address" column="address"/>
        <result property="disk" column="disk"/>
        <result property="name" column="name"/>
        <result property="publicIp" column="public_ip"/>
        <result property="groupName" column="group_name"/>
        <result property="manageName" column="manage_name"/>
        <result property="pingpai" column="pingpai"/>
        <result property="mac" column="mac"/>
        <result property="owner" column="owner"/>
        <result property="ownerNo" column="owner_no"/>
        <result property="locationAddress" column="location_address"/>
        <result property="date" column="date"/>
        <result property="re" column="re"/>
        <result property="cname" column="cname"/>
        <result property="ip" column="ip"/>
        <result property="devtype" column="devtype"/>
        <result property="gip" column="gip"/>
        <result property="height" column="height"/>
        <result property="gap" column="gap"/>
        <result property="loratm" column="loratm"/>
        <result property="witnesstm" column="witnesstm"/>
        <result property="beacontm" column="beacontm"/>
        <result property="lastwitness" column="lastwitness"/>
        <result property="importDataTime" column="import_data_time"/>
        <result property="total24h" column="total24h"/>
        <result property="total7d" column="total7d"/>
        <result property="total30d" column="total30d"/>
        <result property="online" column="online"/>
        <result property="country" column="country"/>
        <result property="city" column="city"/>
        <result property="street" column="street"/>
        <result property="hex" column="Hex"/>
        <result property="depllist" column="depllist"/>
        <result property="status" column="status"/>
        <result property="hearttm" column="hearttm"/>
        <result property="updateTime" column="update_time"/>
        <result property="remark" column="remark"/>
        <result property="errStatus" column="errStatus"/>
        <result property="scale" column="scale"/>
    </resultMap>

    <!--auto generated by MybatisCodeHelper on 2022-03-24-->
    <insert id="insertSelective">
        INSERT INTO business_device
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="id != null">
                id,
            </if>
            <if test="oneLevelName != null">
                one_level_name,
            </if>
            <if test="twoLevelName != null">
                two_level_name,
            </if>
            <if test="en != null">
                en,
            </if>
            <if test="address != null">
                address,
            </if>
            <if test="disk != null">
                disk,
            </if>
            <if test="name != null">
                name,
            </if>
            <if test="publicIp != null">
                public_ip,
            </if>
            <if test="groupName != null">
                group_name,
            </if>
            <if test="manageName != null">
                manage_name,
            </if>
            <if test="pingpai != null">
                pingpai,
            </if>
            <if test="mac != null">
                mac,
            </if>
            <if test="owner != null">
                owner,
            </if>
            <if test="ownerNo != null">
                owner_no,
            </if>
            <if test="locationAddress != null">
                location_address,
            </if>
            <if test="date != null">
                date,
            </if>
            <if test="re != null">
                re,
            </if>
            <if test="cname != null">
                cname,
            </if>
            <if test="ip != null">
                ip,
            </if>
            <if test="devtype != null">
                devtype,
            </if>
            <if test="gip != null">
                gip,
            </if>
            <if test="height != null">
                height,
            </if>
            <if test="gap != null">
                gap,
            </if>
            <if test="loratm != null">
                loratm,
            </if>
            <if test="witnesstm != null">
                witnesstm,
            </if>
            <if test="beacontm != null">
                beacontm,
            </if>
            <if test="lastwitness != null">
                lastwitness,
            </if>
            <if test="importDataTime != null">
                import_data_time,
            </if>
            <if test="total24h != null">
                total24h,
            </if>
            <if test="total7d != null">
                total7d,
            </if>
            <if test="total30d != null">
                total30d,
            </if>
            <if test="online != null">
                online,
            </if>
                country,
                city,
            <if test="street != null">
                street,
            </if>
            <if test="hex != null">
                Hex,
            </if>
            <if test="depllist != null">
                depllist,
            </if>
            <if test="status != null">
                status,
            </if>
            <if test="hearttm != null">
                hearttm,
            </if>
            <if test="updateTime != null">
                update_time,
            </if>
            <if test="remark != null">
                remark
            </if>
            <if test="errStatus != null">
                errStatus
            </if>
            <if test="scale != null">
                scale
            </if>
        </trim>
        VALUES
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="id != null">
                #{id},
            </if>
            <if test="oneLevelName != null">
                #{oneLevelName},
            </if>
            <if test="twoLevelName != null">
                #{twoLevelName},
            </if>
            <if test="en != null">
                #{en},
            </if>
            <if test="address != null">
                #{address},
            </if>
            <if test="disk != null">
                #{disk},
            </if>
            <if test="name != null">
                #{name},
            </if>
            <if test="publicIp != null">
                #{publicIp},
            </if>
            <if test="groupName != null">
                #{groupName},
            </if>
            <if test="manageName != null">
                #{manageName},
            </if>
            <if test="pingpai != null">
                #{pingpai},
            </if>
            <if test="mac != null">
                #{mac},
            </if>
            <if test="owner != null">
                #{owner},
            </if>
            <if test="ownerNo != null">
                #{ownerNo},
            </if>
            <if test="locationAddress != null">
                #{locationAddress},
            </if>
            <if test="date != null">
                #{date},
            </if>
            <if test="re != null">
                #{re},
            </if>
            <if test="cname != null">
                #{cname},
            </if>
            <if test="ip != null">
                #{ip},
            </if>
            <if test="devtype != null">
                #{devtype},
            </if>
            <if test="gip != null">
                #{gip},
            </if>
            <if test="height != null">
                #{height},
            </if>
            <if test="gap != null">
                #{gap},
            </if>
            <if test="loratm != null">
                #{loratm},
            </if>
            <if test="witnesstm != null">
                #{witnesstm},
            </if>
            <if test="beacontm != null">
                #{beacontm},
            </if>
            <if test="lastwitness != null">
                #{lastwitness},
            </if>
            <if test="importDataTime != null">
                #{importDataTime},
            </if>
            <if test="total24h != null">
                #{total24h},
            </if>
            <if test="total7d != null">
                #{total7d},
            </if>
            <if test="total30d != null">
                #{total30d},
            </if>
            <if test="online != null">
                #{online},
            </if>
                #{country},
                #{city},
            <if test="street != null">
                #{street},
            </if>
            <if test="hex != null">
                #{hex},
            </if>
            <if test="depllist != null">
                #{depllist},
            </if>
            <if test="status != null">
                #{status},
            </if>
            <if test="hearttm != null">
                #{hearttm},
            </if>
            <if test="updateTime != null">
                #{updateTime},
            </if>
            <if test="remark != null">
                #{remark}
            </if>
            <if test="errStatus != null">
                #{errStatus}
            </if>
            <if test="scale != null">
                #{remark}
            </if>
        </trim>
    </insert>

    <!--auto generated by MybatisCodeHelper on 2022-03-24-->
    <select id="findAddressByAddress" resultType="java.lang.String">
        select address
        from business_device
        where address = #{address}
    </select>

    <!--auto generated by MybatisCodeHelper on 2022-03-24-->
    <update id="updateByAddress">
        update business_device
        <set>
            <if test="updated.id != null">
                id = #{updated.id},
            </if>
            <if test="updated.oneLevelName != null">
                one_level_name = #{updated.oneLevelName},
            </if>
            <if test="updated.twoLevelName != null">
                two_level_name = #{updated.twoLevelName},
            </if>
            <if test="updated.en != null">
                en = #{updated.en},
            </if>
            <if test="updated.address != null">
                address = #{updated.address},
            </if>
            <if test="updated.disk != null">
                disk = #{updated.disk},
            </if>
            <if test="updated.name != null">
                name = #{updated.name},
            </if>
            <if test="updated.publicIp != null">
                public_ip = #{updated.publicIp},
            </if>
            <if test="updated.groupName != null">
                group_name = #{updated.groupName},
            </if>
            <if test="updated.manageName != null">
                manage_name = #{updated.manageName},
            </if>
            <if test="updated.pingpai != null">
                pingpai = #{updated.pingpai},
            </if>
            <if test="updated.mac != null">
                mac = #{updated.mac},
            </if>
            <if test="updated.owner != null">
                owner = #{updated.owner},
            </if>
            <if test="updated.ownerNo != null">
                owner_no = #{updated.ownerNo},
            </if>
            <if test="updated.locationAddress != null">
                location_address = #{updated.locationAddress},
            </if>
            <if test="updated.date != null">
                date = #{updated.date},
            </if>
            <if test="updated.re != null">
                re = #{updated.re},
            </if>
            <if test="updated.cname != null">
                cname = #{updated.cname},
            </if>
            <if test="updated.ip != null">
                ip = #{updated.ip},
            </if>
            <if test="updated.devtype != null">
                devtype = #{updated.devtype},
            </if>
            <if test="updated.gip != null">
                gip = #{updated.gip},
            </if>
            <if test="updated.height != null">
                height = #{updated.height},
            </if>
            <if test="updated.gap != null">
                gap = #{updated.gap},
            </if>
            <if test="updated.loratm != null">
                loratm = #{updated.loratm},
            </if>
            <if test="updated.witnesstm != null">
                witnesstm = #{updated.witnesstm},
            </if>
            <if test="updated.beacontm != null">
                beacontm = #{updated.beacontm},
            </if>
            <if test="updated.lastwitness != null">
                lastwitness = #{updated.lastwitness},
            </if>
            <if test="updated.importDataTime != null">
                import_data_time = #{updated.importDataTime},
            </if>
            <if test="updated.total24h != null">
                total24h = #{updated.total24h},
            </if>
            <if test="updated.total7d != null">
                total7d = #{updated.total7d},
            </if>
            <if test="updated.total30d != null">
                total30d = #{updated.total30d},
            </if>
            <if test="updated.online != null">
                online = #{updated.online},
            </if>
                country = #{updated.country},
                city = #{updated.city},
            <if test="updated.street != null">
                street = #{updated.street},
            </if>
            <if test="updated.hex != null">
                Hex = #{updated.hex},
            </if>
            <if test="updated.depllist != null">
                depllist = #{updated.depllist},
            </if>
            <if test="updated.status != null">
                status = #{updated.status},
            </if>
            <if test="updated.hearttm != null">
                hearttm = #{updated.hearttm},
            </if>
            <if test="updated.updateTime != null">
                update_time = #{updated.updateTime},
            </if>
            <if test="updated.remark != null">
                remark = #{updated.remark},
            </if>
            <if test="updated.errStatus != null">
                errStatus = #{updated.errStatus},
            </if>
            <if test="updated.scale != null">
                scale = #{updated.scale},
            </if>
        </set>
        where address = #{updated.address}
    </update>

    <!--auto generated by MybatisCodeHelper on 2022-03-24-->
    <select id="findAll" resultType="java.lang.String">
        select
        address
        from business_device where status = 1
        ORDER BY IF(ISNULL(update_time), 0, 1), update_time DESC
    </select>

    <sql id="selectCondition">
        <if test="deviceDTO.name != null and deviceDTO.name != ''">
            (one_level_name=#{deviceDTO.name} or
            two_level_name in
            <foreach item="item" index="index" collection="deviceDTO.name.split('@@')" open="(" separator="," close=")">
                #{item}
            </foreach>)
        </if>

        <if test="'未知' == deviceDTO.country">
            and country IS NULL
        </if>
        <if test="'未知' != deviceDTO.country and null != deviceDTO.country  and deviceDTO.country != ''">
            and country = #{deviceDTO.country}
        </if>

        <if test="'未知' == deviceDTO.city">
            and city IS NULL
        </if>
        <if test="'未知' != deviceDTO.city and null != deviceDTO.city  and deviceDTO.city != ''">
            and city = #{deviceDTO.city}
        </if>

        <if test="'未知' == deviceDTO.oneLevelName">
            and one_level_name IS NULL
        </if>
        <if test="'未知' != deviceDTO.oneLevelName and null != deviceDTO.oneLevelName  and deviceDTO.oneLevelName != ''">
            and one_level_name = #{deviceDTO.oneLevelName}
        </if>

        <if test="'未知' == deviceDTO.twoLevelName">
            and two_level_name IS NULL
        </if>
        <if test="'未知' != deviceDTO.twoLevelName and null != deviceDTO.twoLevelName  and deviceDTO.twoLevelName != ''">
            and two_level_name = #{deviceDTO.twoLevelName}
        </if>

        <if test="'未知' == deviceDTO.manageName">
            and manage_name IS NULL
        </if>
        <if test="'未知' != deviceDTO.manageName and null != deviceDTO.manageName  and deviceDTO.manageName != ''">
            and manage_name = #{deviceDTO.manageName}
        </if>

        <if test="'未知' == deviceDTO.groupName">
            and group_name IS NULL
        </if>
        <if test="'未知' != deviceDTO.groupName and null != deviceDTO.groupName and deviceDTO.groupName != ''">
            and group_name = #{deviceDTO.groupName}
        </if>

        <if test="'未知' != deviceDTO.online and null != deviceDTO.online and deviceDTO.online != ''">
            and online = #{deviceDTO.online}
        </if>
        <if test="'未知' == deviceDTO.online">
            and online IS NULL
        </if>

        <if test="deviceDTO.depllist != null and deviceDTO.depllist != '' and '未知' != deviceDTO.depllist">
            and depllist = #{deviceDTO.depllist}
        </if>
        <if test="'未知' == deviceDTO.depllist">
            and depllist IS NULL
        </if>
        <if test="deviceDTO.key != null and deviceDTO.key != ''">
            and (one_level_name like concat('%', #{deviceDTO.key},'%') or two_level_name like concat('%', #{deviceDTO.key},'%'))
        </if>
        and status = 1
    </sql>

    <!--auto generated by MybatisCodeHelper on 2022-03-24-->
    <select id="selectAllPaging" resultMap="businessDeviceMap">
        select
        <include refid="Base_Column_List"/>
        from business_device
        <where>
            <include refid="selectCondition"/>
        </where>
        limit #{deviceDTO.pageConvertLine}
                , #{deviceDTO.limit}
    </select>

    <select id="selectAllCount" resultType="java.lang.Integer">
        select count(*)
        from business_device
        <where>
            <include refid="selectCondition"/>
        </where>
    </select>

    <select id="selectFilterable" resultMap="businessDeviceMap">
        select
        <include refid="Base_Column_List"/>
        from business_device
        <where>
            <include refid="selectCondition"/>
        </where>
    </select>

    <select id="findSelect" resultType="io.renren.modules.business.dao.Select">
        <!--    状态    -->
        <if test="typeId == 1">
            SELECT concat(IF(`online` is not null, `online`, '未知'), ' 【', count(*),
                          '】') as 'label', IF(`online` is not null,`online` , '-1') as 'value'
            from business_device
            <where>
                <include refid="selectCondition"/>
            </where>
            GROUP BY `online`
        </if>
        <!--     黑名单   -->
        <if test="typeId == 2">
            SELECT concat(IF(depllist = '1', '存在', ''), IF(depllist = '0', '不存在', ''), IF(depllist is null, '未知', ''),
                          ' 【', count(*), '】') AS 'label', IF(`depllist` is not null,`depllist` , '-1') AS 'value'
            from business_device
            <where>
                <include refid="selectCondition"/>
            </where>
            GROUP BY `depllist`
        </if>
    </select>

<!--auto generated by MybatisCodeHelper on 2022-04-11-->
    <select id="findOwnerByAddress" resultType="java.lang.String">
        select `owner`
        from business_device
        where address=#{address} and status = 1 limit 1
    </select>

    <update id="clear">
        UPDATE `business_device`  SET status = 0
    </update>
</mapper>
